<div
  id="map"
  style="width: 100%;
  height: 30vh;"
  data-markers="<%= @markers.to_json %>"
  data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"
></div>

<h4 id ="current-address">Montr√©al</h4>
<input id="search_bar" type="text">
<div class="index-review-container">
  <h3 class="index-h3"><strong>Top <%= @category.name %> </strong></h3>
  <div class="container_card main_dish_search">
    <% @list.each do |dish| %>
      <div class="card main_dish_search_card" data-description="<%= dish.name %>">
        <img src="<%= dish.restaurant.photo %>" alt="dish photo", class="logo">
        <div class="card_ban d-flex justify-content-end" style="background-image: url(<%= dish.photo %>);">
          <div>
            <% if !user_signed_in? || current_user.favorites.filter { |favorite| favorite.dish == dish}.empty? %>
              <%= link_to '<i class="far fa-heart"></i>'.html_safe, dish_favorites_path(dish), class: 'link-to-text-color', method: :post%>
            <% else %>
              <%= link_to '<i class="fas fa-heart"></i>'.html_safe, dish_favorite_path(dish, current_user.favorites.filter { |favorite| favorite.dish == dish}.first ), class: 'link-to-text-color-liked', method: :delete%>
            <% end %>
          </div>
        </div>
        <%= link_to dish_path(dish), class: "link-to-dish" do %>
          <div class="card_detail">
            <div class="d-flex justify-content-end">
              <span><strong><%= dish.votes.map{|vote| vote.vote}.sum %></strong></span>
              <div class="like ml-2">
                <i class="fas fa-thumbs-up"></i>
              </div>
            </div>
            <h4 class="txt"><%= dish.name %></h4>
            <div class="d-flex justify-content-between">
              <span class="txt_desc">
                <%= dish.restaurant.name %>
              </span>
              <span class="txt_desc">
                <%= "$" * (dish.price) %>
              </span>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>


  <% if user_signed_in? %>
    <h3 class="index-h3"><strong>Your Favorites</strong></h3>
    <div class="container_card">
      <% current_user.favorites.each do |favorite| %>
        <div class="card">
          <img src="<%= favorite.dish.restaurant.photo %>" alt="dish photo", class="logo">
            <div class="card_ban d-flex justify-content-end"style="background-image: url(<%= favorite.dish.photo %>);">
              <div>
                <% if current_user.favorites.filter { |favorites| favorites.dish == favorite.dish}.empty? %>
                  <%= link_to '<i class="far fa-heart"></i>'.html_safe, dish_favorites_path(favorite.dish), class: 'link-to-text-color', method: :post%>
                <% else %>
                  <%= link_to '<i class="fas fa-heart"></i>'.html_safe, dish_favorite_path(favorite.dish, current_user.favorites.filter { |favorites| favorites.dish == favorite.dish}.first ), class: 'link-to-text-color-liked', method: :delete%>
               <% end %>
             </div>
          </div>
        <%= link_to dish_path(favorite.dish), class: "link-to-dish" do %>
          <div class="card_detail">
            <div class="d-flex justify-content-end">
              <span><strong><%= favorite.dish.votes.map{|vote| vote.vote}.sum %></strong></span>
              <div class="like">
                <i class="fas fa-thumbs-up"></i>
              </div>
            </div>
            <h4 class="txt"><%= favorite.dish.name %></h4>
            <span class="txt_desc"><%= favorite.dish.restaurant.name %><%= "   " %><%= "$" * (favorite.dish.price) %></span>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>
<h3 class="index-h3"><strong>Recommended for You</strong></h3>
<div class="container_card_lg">
  <% @dishes[1..6].each do |dish| %>
    <%= link_to dish_path(dish), class: "link-to-dish" do %>
      <div class="card_lg">
        <img src="<%= dish.photo %>" alt="dish photo">
          <div class="flex-grow-1">
            <div class="justify-content-end text-right">
              <span>
                <strong><%= dish.votes.map{|vote| vote.vote}.sum %><i class="fas fa-thumbs-up ml-2"></i></strong>
              </span>
            </div>
            <div class="card_infos">
              <h2 class="txt"><%= dish.name %></h2>
              <p class="txt_desc"><%= dish.restaurant.name %></p>
            </div>
          </div>
      </div>
    <% end %>
  <% end %>
</div>

<script>
  // main_dish_search_card
  const mainDishSearchCards = document.querySelectorAll(".main_dish_search_card")

  const searchBar = document.getElementById("search_bar");
  searchBar.addEventListener("input", (event) => {
    console.log(event.currentTarget.value);

    const searchQuery = event.currentTarget.value;

    mainDishSearchCards.forEach((card) => {
      const nameOfDish = card.getAttribute("data-description")

      if (nameOfDish.toLowerCase().includes(searchQuery.toLowerCase())) {
        card.style.display = "inline-block";
      } else {
        card.style.display = "none";
      }

      if (nameOfDish.length === 0 ) {
        card.style.display = "block";
      }
    })



  })


</script>
