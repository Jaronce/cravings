<!-- Map Area -->
<div class="mobile-forehead">
  <div
    id="map"
    style="width: 100%;
    height: 300px;"
    data-markers="<%= @markers.to_json %>"
    data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"
  ></div>
    <h4 id ="current-address" style="margin: 24px auto; margin-left: 20px;">5333 Casgrain Ave, Montreal, QC</h4>
</div>

<!-- Top 10 dishes -->
<div class="index-review-container">
    <input id="search_bar" type="text">
  <h3 class="index-title top"><strong>Top 10 <%= @category.name %> </strong></h3>
  <div class="container_card">
    <% @list.each do |dish| %>
      <%# <div class="card"> %>
      <div class="card main_dish_search_card" data-description="<%= dish.name %>">
        <img src="<%= dish.restaurant.photo %>" alt="dish photo", class="logo">
        <!-- <div class="card_ban d-flex justify-content-end" style="background-image: linear-gradient(rgba(255, 255, 255, 0.25),rgba(255, 255, 255, 0.25)), url(<%= dish.photo %>);"> -->
        <div class="card_ban d-flex justify-content-end" style="background-image: url(<%= dish.photo %>);">
          <div>
            <% if !user_signed_in? || current_user.favorites.filter { |favorite| favorite.dish == dish}.empty? %>
            <!-- create favorite -->
              <%= link_to '<i class="far fa-heart"></i>'.html_safe, toggle_path(dish), class: 'link-to-text-color', method: :get, remote: true, data: { dish: dish.id } %>
            <% else %>
              <% my_favorite = current_user.favorites.filter { |favorite| favorite.dish == dish}.first %>
              <!-- delete favorite -->
              <%= link_to '<i class="fas fa-heart"></i>'.html_safe, toggle_path(dish, favorite_id: my_favorite.id), class: 'link-to-text-color-liked', method: :get, remote: true, data: { favorite: my_favorite.id } %>
            <% end %>
          </div>
        </div>
        <%= link_to dish_path(dish), class: "link-to-dish" do %>
          <div class="card_detail">
            <div class="vote-num d-flex justify-content-end">
              <span><strong><%= dish.votes.map{|vote| vote.vote}.sum %></strong></span>
              <i class="fas fa-thumbs-up"></i>
            </div>
            <div class="card-content d-flex flex-column justify-content-between">
              <h4 class="txt"><%= dish.name %></h4>
              <div class="txt-subtilte d-flex justify-content-between">
                <span class="txt_desc">
                  <%= dish.restaurant.name %>
                </span>
                <span class="txt_desc">
                  <%= "$" * (dish.price) %>
                </span>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

<!-- User's Favorite -->
  <% if current_user.favorites %>
  <div class="index-review-container"> 
    <%# <% if user_signed_in? %> 
      <h3 class="index-title"><strong>Your Favorites</strong></h3>
      <div class="container_card" id="container_favorite_card">
        <% current_user.favorites.each do |favorite| %>
          <div class="card" data-card="<%= favorite.id %>">
            <img src="<%= favorite.dish.restaurant.photo %>" alt="dish photo", class="logo">
              <div class="card_ban d-flex justify-content-end" style="background-image: url(<%= favorite.dish.photo %>);">
                <div>
                  <% if current_user.favorites.filter { |favorites| favorites.dish == favorite.dish}.empty? %>
                    <%= link_to '<i class="far fa-heart"></i>'.html_safe, dish_favorites_path(favorite.dish), class: 'link-to-text-color', method: :post%>
                  <% else %>
                    <%= link_to '<i class="fas fa-heart"></i>'.html_safe, dish_favorite_path(favorite.dish, current_user.favorites.filter { |favorites| favorites.dish == favorite.dish}.first ), class: 'link-to-text-color-liked', method: :delete%>
                 <% end %>
               </div>
            </div>
          <%= link_to dish_path(favorite.dish), class: "link-to-dish" do %>
            <div class="card_detail">
              <div class="vote_num_2 d-flex justify-content-end">
                <span><strong><%= favorite.dish.votes.map{|vote| vote.vote}.sum %></strong></span>
                <i class="fas fa-thumbs-up"></i>
              </div>
              <div class="d-flex flex-column justify-content-between card-content">
                <h4 class="txt"><%= favorite.dish.name %></h4>
                <div class="txt-subtilte d-flex justify-content-between">
                  <span class="txt_desc">
                    <%= favorite.dish.restaurant.name %>
                  </span>
                  <span class="txt_desc">
                    <%= "$" * (favorite.dish.price) %>
                  </span>
                </div>

              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>



<!--Suggested Dishes -->
<h3 class="index-title"><strong>Suggested</strong></h3>
<div class="container_card_lg">
  <% @other_list[1..6].each do |dish| %>
    <%= link_to dish_path(dish), class: "link-to-dish" do %>
      <div class="card_lg">
        <img src="<%= dish.photo %>" alt="dish photo">
          <div class="flex-grow-1">
            <div class="vote_num_3 justify-content-end text-right">
              <span>
                <strong><%= dish.votes.map{|vote| vote.vote}.sum %><i class="like fas fa-thumbs-up"></i></strong>
              </span>
            </div>
            <div class="card_infos">
              <h2 class="txt"><%= dish.name %></h2>
              <p class="txt_desc"><%= dish.restaurant.name %><%= "   " %></p>
            </div>
          </div>
      </div>
    <% end %>
  <% end %>
</div>

<script>
  // main_dish_search_card
  const mainDishSearchCards = document.querySelectorAll(".main_dish_search_card")
  const searchBar = document.getElementById("search_bar");
  searchBar.addEventListener("input", (event) => {
    console.log(event.currentTarget.value);
    const searchQuery = event.currentTarget.value;
    mainDishSearchCards.forEach((card) => {
      const nameOfDish = card.getAttribute("data-description")
      if (nameOfDish.toLowerCase().includes(searchQuery.toLowerCase())) {
        card.style.display = "inline-block";
      } else {
        card.style.display = "none";
      }
      if (nameOfDish.length === 0 ) {
        card.style.display = "block";
      }
    })
  })
</script>
